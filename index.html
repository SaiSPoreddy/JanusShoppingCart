<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Janus Parts Shopping Cart</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input[type="number"] { width: 60px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
    #results { margin-top: 20px; }
    #finalList { width: 100%; height: 150px; }
    #cartContainer { margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; background-color: #f9f9f9; }
  </style>
</head>
<body>

<h1>Janus Parts Shopping Cart</h1>

<div id="cartContainer">
  <h2>Final List</h2>
  <textarea id="finalList" readonly placeholder="Your final list will appear here"></textarea><br>
  <button id="copyButton">Copy to Clipboard</button>
</div>

<label for="searchInput">Search Part Number or Description:</label><br>
<input type="text" id="searchInput" placeholder="Type to search...">

<div id="results"></div>

<script>
let products = [];
let cart = [];

// Load CSV
fetch('JanusPartsRevA.csv')
  .then(res => res.text())
  .then(csvText => {
    const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
    products = parsed.data.map(row => {
      const get = key => (row[key] ?? row[key.trim()] ?? '').toString().trim();
      return {
        id: get('Part Number'),
        name: get('Description'),
        stock: get('Qty'),
        unit: get('Column1'),
        cost: get('Avg Cost')
      };
    });
    console.log(`Loaded ${products.length} products`);
  })
  .catch(err => console.error('Error loading CSV:', err));

// Search functionality
const searchInput = document.getElementById('searchInput');
const resultsDiv = document.getElementById('results');
const finalList = document.getElementById('finalList');
const copyButton = document.getElementById('copyButton');

searchInput.addEventListener('input', () => {
  const query = searchInput.value.toLowerCase();
  const filtered = products.filter(p => 
    p.id.toLowerCase().includes(query) || p.name.toLowerCase().includes(query)
  );

  resultsDiv.innerHTML = '';
  if (filtered.length === 0) {
    resultsDiv.innerHTML = '<p>No matching items</p>';
    return;
  }

  const table = document.createElement('table');
  const header = document.createElement('tr');
  header.innerHTML = `<th>Part Number</th><th>Description</th><th>Qty</th><th>Action</th>`;
  table.appendChild(header);

  filtered.forEach(p => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${p.id}</td>
      <td>${p.name}</td>
      <td><input type="number" min="0" value="1" id="qty-${p.id}"></td>
      <td><button onclick="addToCart('${p.id}')">Add</button></td>
    `;
    table.appendChild(row);
  });

  resultsDiv.appendChild(table);
});

// Add to cart
function addToCart(id) {
  const qtyInput = document.getElementById(`qty-${id}`);
  const qty = parseInt(qtyInput.value);
  if (qty <= 0) return;

  const product = products.find(p => p.id === id);
  const existing = cart.find(item => item.id === id);
  if (existing) {
    existing.qty += qty;
  } else {
    cart.push({ ...product, qty });
  }
  updateFinalList();
}

// Update final list WITH HEADER
function updateFinalList() {
  const header = "Part Number | Description | Quantity";
  const lines = cart.map(item =>
    `${item.id} | ${item.name} | ${item.qty}`
  );
  finalList.value = [header, ...lines].join('\n');
}

// Copy to clipboard (always copies header)
copyButton.addEventListener('click', () => {
  finalList.focus();
  finalList.select();
  document.execCommand('selectAll');
  document.execCommand('copy');
  alert('Copied to clipboard!');
});
</script>

</body>
</html>
